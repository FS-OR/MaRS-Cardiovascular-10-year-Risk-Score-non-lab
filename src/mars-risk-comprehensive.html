<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<!-- 
  MaRS – Comprehensive Cardiovascular Risk Tools
  Author: Vicențiu Bogdan Ion Marciu
  Version: 1.0 – October 2025
  License: MaRS Open Collaboration License
  License Version: 1.0 – 2025-10-06
-->
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MaRS – Comprehensive Cardiovascular Risk Tools</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>

<style>
/* MaRS – Style Sheet (v1.0)
   Author: Vicențiu Bogdan Ion Marciu
   License: MaRS Open Collaboration License (Version 1.0 – 2025-10-06)
*/
body {
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  background-color: #f8f9fa;
  margin: 40px auto;
  max-width: 520px;
  color: #222;
}
h1 {
  text-align: center;
  color: #0e7afe;
  font-size: 1.8em;
  margin-bottom: 20px;
}
h2 {
  color: #0e7afe;
  font-size: 1.4em;
  margin-top: 30px;
  margin-bottom: 10px;
  text-align: center;
}
.card {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}
label {
  display: block;
  margin-bottom: 12px;
  font-weight: 500;
}
input,
select {
  width: 100%;
  margin-top: 4px;
  padding: 6px 8px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 15px;
  background-color: #fff;
  box-sizing: border-box;
}
.row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}
.btn {
  width: 100%;
  margin-top: 16px;
  background-color: #0e7afe;
  color: #fff;
  border: none;
  padding: 10px 0;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: background-color 0.2s ease;
}
.btn:hover {
  background-color: #0b66d1;
}
.results {
  margin-top: 18px;
  text-align: center;
  font-size: 18px;
  font-weight: 600;
}
.ok {
  color: #007e33;
}
.warn {
  color: #ff8800;
}
.bad {
  color: #cc0000;
}
.foot {
  margin-top: 30px;
  font-size: 13px;
  text-align: center;
  color: #555;
  line-height: 1.4em;
}
hr {
  margin: 25px 0;
  border: none;
  border-top: 1px solid #ddd;
}
.muted {
  color: #666;
  font-size: 13px;
}
.pill {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
}
.chip {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 999px;
  font-size: 12px;
  background: #f1f5f9;
  color: #222;
  margin-left: 6px;
}
.banner {
  background: #e6f0ff;
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  margin-bottom: 20px;
}
.banner a {
  color: #0e7afe;
  text-decoration: none;
}
.banner a:hover {
  text-decoration: underline;
}
.toggle-details {
  cursor: pointer;
  color: #0e7afe;
  font-size: 13px;
  margin-top: 10px;
}
.chart-container {
  margin-top: 20px;
  padding: 20px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}
</style>
</head>
<body>


<div class="banner">
  <h2>MaRS – Comprehensive Cardiovascular Risk Tools</h2>
  <p>MaRS is a research project for non-laboratory cardiovascular risk determination, currently under validation within the <b>Fast Science – Open Research</b> initiative. It aims to promote simple and broad participation of health professionals in clinical research.</p>
  <p><a href="https://github.com/FS-OR/MaRS-Cardiovascular-10-year-Risk-Score-non-lab" target="_blank">GitHub Repository</a> | <a href="https://github.com/FS-OR/MaRS-Cardiovascular-10-year-Risk-Score-non-lab/blob/main/LICENSE" target="_blank">MaRS Open Collaboration License</a></p>
</div>


<h1>MaRS – Comprehensive Cardiovascular Risk Tools</h1>
<hr>

<!-- ======================================================
1. BLOOD PRESSURE INTERPRETER – AHA vs ESH
======================================================= -->
<h2>1. Blood Pressure Interpreter – AHA vs ESH</h2>

<div class="card">
  <div class="row">
    <div>
      <label for="sbp">SBP (mmHg)</label>
      <input id="sbp" type="number" min="50" max="260" step="1" placeholder="e.g. 128">
    </div>
    <div>
      <label for="dbp">DBP (mmHg)</label>
      <input id="dbp" type="number" min="30" max="160" step="1" placeholder="e.g. 82">
    </div>
    <div>
      <label for="context">Context</label>
      <select id="context">
        <option value="office">Office / Clinic</option>
        <option value="home_day">Home or ABPM Daytime</option>
        <option value="night">ABPM Nighttime</option>
        <option value="twentyfour">ABPM 24h Average</option>
      </select>
    </div>
  </div>

  <div class="row" style="margin-top:12px;">
    <div>
      <label><input id="isDaytime" type="checkbox"> Measurement during daytime?</label>
    </div>
    <div id="activityWrap" style="display:none;">
      <label for="activity">Activity level at/within 30 min</label>
      <select id="activity">
        <option value="rest">Seated rest (5+ min)</option>
        <option value="light">Light (walking casually, chores)</option>
        <option value="moderate">Moderate (brisk walk, stairs, cycling &lt; 15 km/h)</option>
        <option value="vigorous">Vigorous (running, HIIT, heavy lifting)</option>
      </select>
    </div>
    <div id="correctionWrap" style="display:none;">
      <label class="small"><input id="applyCorr" type="checkbox"> Apply heuristic correction for recent activity</label>
      <div class="muted small">Not a medical adjustment. Prefer resting 5 minutes and re-measure.</div>
    </div>
  </div>

  <button class="btn" id="runBtn">Interpret</button>
</div>

<div class="results" id="results"></div>

<div class="card">
  <p><b>Notes:</b></p>
  <ul>
    <li>Classification chooses the higher category if SBP and DBP differ.</li>
    <li>Diagnostic thresholds depend on context (office/home/night/24h).</li>
    <li>Heuristic correction subtracts small offsets if measured during activity: light -5/-3, moderate -10/-6, vigorous -15/-10 mmHg.</li>
    <li>For medical decisions, use standardized measurements and professional guidance.</li>
  </ul>
  <p><b>Legend:</b></p>
  <p>SBP = Systolic Blood Pressure<br>DBP = Diastolic Blood Pressure</p>
</div>

<!-- BP SCRIPT -->
<script>
let mars_risk_value = null;
let chd_risk_value = null;
let cvd_risk_value = null;

const format = (n) => isNaN(n) ? '' : Math.round(n);

function ahaCategory(sbp, dbp){
  if (sbp >= 180 || dbp >= 120) return {label: 'Hypertensive Crisis', tone: 'bad'};
  if (sbp >= 140 || dbp >= 90) return {label: 'Stage 2 Hypertension', tone: 'bad'};
  if ((sbp >= 130 && sbp <= 139) || (dbp >= 80 && dbp <= 89)) return {label: 'Stage 1 Hypertension', tone: 'warn'};
  if (sbp >= 120 && sbp <= 129 && dbp < 80) return {label: 'Elevated', tone: 'warn'};
  if (sbp < 120 && dbp < 80) return {label: 'Normal', tone: 'ok'};
  return {label: 'Uncategorized', tone: 'ok'};
}

function eshCategory(sbp, dbp){
  if (sbp >= 180 || dbp >= 110) return {label: 'Grade 3 Hypertension', tone: 'bad'};
  if ((sbp >= 160 && sbp <= 179) || (dbp >= 100 && dbp <= 109)) return {label: 'Grade 2 Hypertension', tone: 'bad'};
  if ((sbp >= 140 && sbp <= 159) || (dbp >= 90 && dbp <= 99)) return {label: 'Grade 1 Hypertension', tone: 'warn'};
  if ((sbp >= 130 && sbp <= 139) || (dbp >= 85 && dbp <= 89)) return {label: 'High Normal', tone: 'warn'};
  if ((sbp >= 120 && sbp <= 129) || (dbp >= 80 && dbp <= 84)) return {label: 'Normal', tone: 'ok'};
  if (sbp < 120 && dbp < 80) return {label: 'Optimal', tone: 'ok'};
  return {label: 'Uncategorized', tone: 'ok'};
}

const thresholds = {
  office: { aha:{sbp:130, dbp:80}, esh:{sbp:140, dbp:90} },
  home_day: { aha:{sbp:130, dbp:80}, esh:{sbp:135, dbp:85} },
  night: { aha:{sbp:110, dbp:65}, esh:{sbp:120, dbp:70} },
  twentyfour: { aha:{sbp:125, dbp:75}, esh:{sbp:130, dbp:80} }
};

function diagnosticStatus(sbp, dbp, ctx){
  const t = thresholds[ctx];
  const ahaDx = (sbp >= t.aha.sbp) || (dbp >= t.aha.dbp);
  const eshDx = (sbp >= t.esh.sbp) || (dbp >= t.esh.dbp);
  return { ahaDx, eshDx, t };
}

function applyHeuristicCorrection(sbp, dbp, daytime, activity, apply){
