<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MaRS — Comprehensive Cardiovascular Risk Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b1020; --fg:#e8ecf1; --muted:#a9b3c1;
      --card:#121833; --accent:#7dd3fc; --ok:#14b8a6; --warn:#f59e0b; --bad:#ef4444;
      --border:#233155;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
      color:var(--fg); background:linear-gradient(180deg,#0b1020,#0a0f1e 30%,#0b1020);
    }
    header{
      padding:32px 20px 12px; text-align:center; border-bottom:1px solid var(--border);
      background: radial-gradient(1000px 400px at 50% -200px, #18315355, transparent 60%);
    }
    h1{margin:0; font-weight:800; letter-spacing:.2px}
    .tagline{color:var(--muted); margin-top:8px}
    .wrap{max-width:1100px; margin:0 auto; padding:20px}
    .panel{
      background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px;
      box-shadow:0 8px 32px rgba(0,0,0,.25)
    }
    .grid{
      display:grid; gap:16px;
    }
    @media (min-width: 900px){
      .grid-2{grid-template-columns: 1.1fr .9fr}
      .grid-3{grid-template-columns: 1fr 1fr 1fr}
    }
    label{display:block; font-size:14px; color:var(--muted); margin:10px 0 6px}
    input, select{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border);
      background:#0c1330; color:var(--fg); outline:none;
    }
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .btn{
      margin-top:14px; padding:12px 14px; border-radius:12px; border:1px solid #2a3b6b;
      background:linear-gradient(180deg,#1a2750,#132149); color:#e6f5ff; font-weight:700; cursor:pointer;
    }
    .btn:hover{filter:brightness(1.06)}
    .cards{display:grid; gap:14px}
    @media (min-width:900px){ .cards{grid-template-columns:1fr 1fr 1fr} }
    .card{
      border:1px solid var(--border); border-radius:16px; padding:16px; background:#0e1636;
      min-height:150px
    }
    .kpi{font-size:36px; font-weight:800}
    .sub{color:var(--muted); font-size:13px}
    .pill{display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; font-weight:700}
    .ok{background: #063e33; color:#bdfbea; border:1px solid #0b7d66}
    .warn{background:#412c03; color:#ffe9b3; border:1px solid #805d09}
    .bad{background:#3f0b0b; color:#ffd1d1; border:1px solid #a11d1d}
    .small{font-size:12px; color:var(--muted)}
    .muted{color:var(--muted)}
    footer{margin-top:26px; padding:18px; text-align:center; color:var(--muted)}
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    .section-title{font-weight:800; margin:18px 0 8px}
    .hr{height:1px; background:var(--border); margin:16px 0}
  </style>
</head>
<body>
  <header>
    <h1>MaRS — Comprehensive Cardiovascular Risk Tools</h1>
    <p class="tagline">
      MaRS is a non-laboratory cardiovascular risk research framework (unvalidated) under Fast Science / Open Research.
      For clinical decisions, see the <a href="https://github.com/FS-OR/MaRS-Cardiovascular-10-year-Risk-Score-non-lab" target="_blank" rel="noopener">GitHub repo</a> and <a href="https://github.com/FS-OR/MaRS-Cardiovascular-10-year-Risk-Score-non-lab/blob/main/LICENSE" target="_blank" rel="noopener">License</a>.
    </p>
  </header>

  <main class="wrap grid grid-2">
    <!-- Left: Inputs -->
    <section class="panel">
      <div class="section-title">Patient Inputs</div>
      <div class="grid">
        <div class="row">
          <div>
            <label>Age (years)</label>
            <input id="age" type="number" min="30" max="79" placeholder="e.g., 56" />
          </div>
          <div>
            <label>Sex</label>
            <select id="sex">
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Systolic BP (mmHg)</label>
            <input id="sbp" type="number" min="90" max="220" placeholder="e.g., 135" />
          </div>
          <div>
            <label>Antihypertensive treatment</label>
            <select id="treated">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Current smoker</label>
            <select id="smoker">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>
          <div>
            <label>Diabetes</label>
            <select id="diabetes">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>BMI (kg/m²) — for MaRS</label>
            <input id="bmi" type="number" step="0.1" min="16" max="50" placeholder="e.g., 25" />
          </div>
          <div>
            <label>Family history (premature CVD) — for MaRS</label>
            <select id="family">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Total Cholesterol (mg/dL) — for Framingham</label>
            <input id="tc" type="number" min="100" max="400" placeholder="e.g., 220" />
          </div>
          <div>
            <label>HDL (mg/dL) — for Framingham</label>
            <input id="hdl" type="number" min="20" max="120" placeholder="e.g., 56" />
          </div>
        </div>
      </div>

      <button class="btn" onclick="calculate()">Calculate</button>
      <div id="msg" class="small" style="margin-top:8px;"></div>
    </section>

    <!-- Right: Results -->
    <section class="panel">
      <div class="section-title">Results (10-year risk)</div>
      <div class="cards" id="cards">
        <div class="card" id="card-mars">
          <div class="sub">MaRS (Non-lab) — v1.0</div>
          <div class="kpi" id="mars-risk">–</div>
          <div class="small">Logit: <span id="mars-logit">–</span></div>
          <div class="small">Category: <span id="mars-cat" class="pill">–</span></div>
        </div>
        <div class="card" id="card-frs">
          <div class="sub">Framingham (General CVD, 2008)</div>
          <div class="kpi" id="frs-risk">–</div>
          <div class="small">Model: D’Agostino 2008 (sex-specific)</div>
          <div class="small">Inputs: age, TC, HDL, SBP (treat), smoking, diabetes</div>
        </div>
        <div class="card" id="card-delta">
          <div class="sub">Delta (MaRS − Framingham)</div>
          <div class="kpi" id="delta-risk">–</div>
          <div class="small">Agreement: <span id="agree" class="pill">–</span></div>
        </div>
      </div>

      <div class="hr"></div>
      <div class="small">
        <b>Note:</b> Units are mg/dL for lipids, mmHg for blood pressure. Framingham uses the general CVD model with sex-specific coefficients
        and baseline survival (10-year). MaRS is a non-lab research model.
      </div>
    </section>
  </main>

  <section class="wrap panel" style="margin-top:16px">
    <div class="section-title">License & Citation</div>
    <p class="muted">
      MaRS is released under an Open License within the Fast Science / Open Research project and invites all professionals
      to help its clinical validation. When using this tool in research, please cite the GitHub repository and license.
    </p>
    <p>
      • License: <a href="https://github.com/FS-OR/MaRS-Cardiovascular-10-year-Risk-Score-non-lab/blob/main/LICENSE" target="_blank" rel="noopener">MaRS Open Collaboration License</a><br/>
      • Repository: <a href="https://github.com/FS-OR/MaRS-Cardiovascular-10-year-Risk-Score-non-lab" target="_blank" rel="noopener">FS-OR / MaRS — Cardiovascular 10-year Risk (non-lab)</a>
    </p>
  </section>

  <footer>
    © 2025 MaRS — Fast Science / Open Research · Developed by
    <a href="https://linkedin.com/in/bogdan-marciu" target="_blank" rel="noopener">Vicențiu Bogdan Ion Marciu</a> ·
    <a href="https://github.com/FS-OR/MaRS-Cardiovascular-10-year-Risk-Score-non-lab" target="_blank" rel="noopener">GitHub Repository</a>
    <br/>
    <span class="small">MaRS is a research framework and NOT a medical device. Clinical decisions remain with licensed clinicians.</span>
  </footer>

  <script>
    // === MaRS v1.0 (non-lab) — logistic, in-code coefficients (v1 keeps it local/static) ===
    function calcMaRS(age, sex, sbp, treated, smoker, diabetes, bmi, family){
      const logit =
        -3.2 +
        0.07 * (age - 50) +
        0.45 * sex +
        0.18 * ((sbp - 120) / 10) +
        0.15 * treated +
        0.70 * smoker +
        0.70 * diabetes +
        0.22 * ((bmi - 25) / 5) +
        0.40 * family;
      const risk = 100 / (1 + Math.exp(-logit));
      return { risk, logit };
    }

    // === Framingham General CVD (D’Agostino 2008) — sex-specific Cox model ===
    // Risk = 1 - S0^exp( Sum(beta * ln(vars)) + beta_binary - mean )
    function calcFramingham(age, sexStr, tc, hdl, sbp, treated, smoker, diabetes){
      const sex = (sexStr === 'male') ? 'male' : 'female';
      const ln = Math.log;

      // Coefficients (10-year general CVD)
      // Sources: D'Agostino RB, Circulation 2008; commonly used constants in clinical calculators.
      const C = (sex === 'male')
        ? {
            ln_age: 3.06117, ln_tc: 1.12370, ln_hdl: -0.93263,
            ln_sbp_t: 1.99881, ln_sbp_u: 1.93303,
            smoker: 0.65451, diabetes: 0.57367,
            mean: 23.9388, S0: 0.88936
          }
        : {
            ln_age: 2.32888, ln_tc: 1.20904, ln_hdl: -0.70833,
            ln_sbp_t: 2.82263, ln_sbp_u: 2.76157,
            smoker: 0.52873, diabetes: 0.69154,
            mean: 26.0145, S0: 0.95012
          };

      // Validate minimal bounds
      if (age <= 0 || tc <= 0 || hdl <= 0 || sbp <= 0) return { risk: NaN };

      const sum =
        C.ln_age * ln(age) +
        C.ln_tc  * ln(tc)  +
        C.ln_hdl * ln(hdl) +
        (treated ? C.ln_sbp_t : C.ln_sbp_u) * ln(sbp) +
        C.smoker * (smoker ? 1 : 0) +
        C.diabetes * (diabetes ? 1 : 0);

      const risk = 100 * (1 - Math.pow(C.S0, Math.exp(sum - C.mean)));
      return { risk };
    }

    function badgeClass(p){
      if (p < 10) return 'pill ok';
      if (p < 20) return 'pill warn';
      return 'pill bad';
    }
    function badgeText(p){
      if (p < 10) return 'LOW';
      if (p < 20) return 'MODERATE';
      return 'HIGH';
    }

    function valNum(id){ return parseFloat(document.getElementById(id).value); }
    function valInt(id){ return parseInt(document.getElementById(id).value, 10); }
    function valSel(id){ return document.getElementById(id).value; }

    function calculate(){
      const age = valNum('age');
      const sex = valSel('sex');
      const sbp = valNum('sbp');
      const treated = valInt('treated');
      const smoker = valInt('smoker');
      const diabetes = valInt('diabetes');
      const bmi = valNum('bmi');
      const family = valInt('family');
      const tc = valNum('tc');
      const hdl = valNum('hdl');

      const msg = document.getElementById('msg');
      msg.textContent = '';

      // Basic validation
      if (isNaN(age) || isNaN(sbp) || isNaN(bmi)) {
        msg.textContent = 'Please complete Age, SBP, and BMI (required).';
        return;
      }
      if (isNaN(tc) || isNaN(hdl)) {
        msg.textContent = 'For Framingham, please provide Total Cholesterol and HDL.';
      }

      // MaRS
      const sexNum = (sex === 'male') ? 1 : 0;
      const mars = calcMaRS(age, sexNum, sbp, treated, smoker, diabetes, isNaN(bmi)?25:bmi, family);
      const marsP = Math.max(0, Math.min(100, mars.risk));
      document.getElementById('mars-risk').textContent = `${marsP.toFixed(2)}%`;
      document.getElementById('mars-logit').textContent = mars.logit.toFixed(2);
      const marsCat = document.getElementById('mars-cat');
      marsCat.className = badgeClass(marsP);
      marsCat.textContent = badgeText(marsP);

      // Framingham
      let frsP = NaN;
      if (!isNaN(tc) && !isNaN(hdl)) {
        const frs = calcFramingham(age, sex, tc, hdl, sbp, !!treated, !!smoker, !!diabetes);
        frsP = Math.max(0, Math.min(100, frs.risk));
        document.getElementById('frs-risk').textContent = isFinite(frsP) ? `${frsP.toFixed(2)}%` : '–';
      } else {
        document.getElementById('frs-risk').textContent = '–';
      }

      // Delta
      const deltaEl = document.getElementById('delta-risk');
      const agreeEl = document.getElementById('agree');
      if (isFinite(frsP)) {
        const d = marsP - frsP;
        deltaEl.textContent = (d >= 0 ? '+' : '') + d.toFixed(2) + '%';
        const gap = Math.abs(d);
        if (gap < 3){
          agreeEl.className = 'pill ok';
          agreeEl.textContent = 'Good agreement';
        } else if (gap < 7){
          agreeEl.className = 'pill warn';
          agreeEl.textContent = 'Moderate difference';
        } else {
          agreeEl.className = 'pill bad';
          agreeEl.textContent = 'Large difference';
        }
      } else {
        deltaEl.textContent = '–';
        agreeEl.className = 'pill';
        agreeEl.textContent = '–';
      }
    }
  </script>
</body>
</html>
